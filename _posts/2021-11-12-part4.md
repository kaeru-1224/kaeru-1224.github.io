---
layout: post

title: Second Posting:ê°¯ì¸ ë¹„ì°ë¨¹!-Part 4:Gatsbyâ€™s GraphQL data layer
tags: Gatsby
date: 2021-11-12 06:42
---

<h3>Meet Gatsbyâ€™s GraphQL data layer</h3>

ì´ì „ê¹Œì§€ ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ì— ë°”ë¡œ ì´ë¯¸ì§€ë‚˜ ë¬¸ì¥ì„ ì ì–´ì™”ì§€ë§Œ ì¢…ì¢… ë§ˆí¬ë‹¤ìš´ íŒŒì¼ì˜ í´ë”ë‚˜ CMS (content managemebt system)ë“±ì„ í™œìš©í•´ì„œ ë°ì´í„°ë¥¼ ë§Œë“¤ê³  ìœ ì§€í•œë‹¤ìŒ í•„ìš”ì—ë”°ë¼ ì»´í¬ë„ŒíŠ¸ì— ë„£ì–´ì£¼ëŠ” ë°©ë²• ì—­ì‹œ ìš©ì´í•˜ë‹¤.

âœ…Data layer

![datalayer_ex](https://www.gatsbyjs.com/static/e45422900475b86807bc002fb6863b85/5df5d/data-layer.png)

ê°¯ì¸ ë¹„ëŠ” ì–´ë””ë¡œë¶€í„°ë‚˜ ë°ì´í„°ë¥¼ ë°ë ¤ì˜¬ ìˆ˜ ìˆëŠ” ë°ì´í„° ë ˆì´ì–´ë¥¼ ì§€ë‹ˆê³  ìˆë‹¤.
ê·¸ëŸ°ë° ì—¬ê¸°ì„œ `ì–´ë””ë¡œë¶€í„°`ëŠ” ë‹¨ì–´ ê·¸ëŒ€ë¡œ ë°ì´í„°ë¥¼ Shopifyë‚˜ Airtableì— ë„£ì–´ë„ ì—¬ëŸ¬ ë°ì´í„° ì†ŒìŠ¤ë“¤ì„ ê²°í•©í•´ì„œ ì‚¬ìš©í•  ìˆ˜ìˆë„ë¡ í•œë‹¤ëŠ” ì˜ë¯¸ë¡œ GraphQLì´ ì´ëŸ¬í•œ ì‘ì—…ì„ í• ìˆ˜ìˆë„ë¡£ ìš°ë¦¬ë¥¼ ë„ì™€ì¤„ ê²ƒì´ë‹¤.

ğŸ¤” ê·¸ëŸ¬ë©´ GraphQLì´ ì–´ë–¤ì‹ìœ¼ë¡œ ì‘ë™í• ê¹Œ?

- í•œê°œ í˜¹ì€ ê·¸ì´ìƒì˜ `ê³µê°„(source)`ì— ë°ì´í„°ê°€ ì €ì¥ëœë‹¤. ì´ë•Œ ê·¸
  ê³µê°„ì€ ì‚¬ìš©ìì˜ ì»´í“¨í„°ì˜ íŒŒì¼ ì‹œìŠ¤í…œì¼ìˆ˜ë„ ìˆê³  CMSì¼ìˆ˜ë„ ìˆìœ¼ë©° í˜¹ì€ ë°ì´í„° ë² ì´ìŠ¤ ì¼ìˆ˜ë„ ìˆë‹¤.

ğŸ¤” ê·¸ëŸ¬ë©´ ê·¸ ê³µê°„ìœ¼ë¡œë¶€í„° ë°ì´í„°ë ˆì´ì•„ì›ƒê¹Œì§€ ë°ì´í„°ëŠ” ì–´ë–»ê²Œ ì–»ì„ ìˆ˜ìˆì„ê¹Œ.

- ê°¯ì¸ ë¹„ì˜ ê²½ìš° `source plugin`ì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ë°ì´í„°ë¥¼ ì–»ì–´ì˜¬ ìˆ˜ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.

âœ” ê°¯ì¸ ë¹„ íŠœí† ë¦¬ì–¼ì˜ ê²½ìš° ìœ ëª… í”ŒëŸ¬ê·¸ì¸ì¸ `gatsby-source-filesystem`ë‚˜ `gatsby-source-contentful`ë¥¼ ì˜ˆì‹œë¡œ ë“¤ê³  ìˆë‹¤.

ğŸ¤”ê·¸ëŸ¬ë©´ ê·¸ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ì§€?

- GraphQL ì¿¼ë¦¬ë¬¸ì„ ì´ìš©í•´ì„œ ì›í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì— ë°ì´í„°ë¥¼ í™œìš©í•  ìˆ˜ìˆë„ë¡ í•´ì¤€ë‹¤.

<h3>Use GraphiQL to explore the data layer and write GraphQL queries</h3>

ğŸ¤” ì‚¬ìš©ìê°€ ì–´ë–»ê²Œ ìì‹ ì˜ ì‚¬ì´íŠ¸ì˜ GraphQL ë°ì´í„° ë ˆì´ì–´ë¥¼ ì•Œ ìˆ˜ ìˆì„ê¹Œ?

![ GraphiQL_ex](https://www.gatsbyjs.com/static/c6b53975530da3347f0e0d12fc175208/84a90/graphiql.png)

- ê°¯ì¸ ë¹„ ì—ì„œëŠ” ê°œë°œì ì„œë²„ë¥¼ ì‹¤í–‰í• ë•Œ ìë™ì ìœ¼ë¡œ `GrahpiQL`ì´ë¼ëŠ” ë¸Œë¼ìš°ì € í‹€ì„ ë§Œë“¤ì–´ì£¼ëŠ”ë°,`GrahpiQL`ë¥¼ í†µí•´ì„œ ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³  ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ ë³¼ ìˆ˜ìˆë‹¤.

-`gatsby develop.`ì´ë‚˜ ` npm run start`ë“±ìœ¼ë¡œ ì‹œì‘

```
You can now view frog in the browser.
â €
  http://localhost:8000/
â €
View GraphiQL, an in-browser IDE, to explore your site's data and schema
â €
  http://localhost:8000/___graphql
â €
```

-ìœ„ì™€ ê°™ì´ `http://localhost:8000/___graphql`(= `GrahpiQL`ì˜ ì£¼ì†Œ)ë¼ëŠ” ì£¼ì†Œë¥¼ ì–»ê²Œëœë‹¤.

ğŸ¤”`GrahpiQL`?

-`GrahpQL`ì¿¼ë¦¬ë¥¼ ì½”ë“œì— ì¶”ê°€í•˜ê¸°ì „ ì‹œí—˜í•˜ê¸°ì— ìš©ì´í•˜ë‹¤

<h3>Queries in building-block components: Pull the site title into the Layout component</h3>

ì»´í¬ë„ŒíŠ¸ì˜ ì¢…ë¥˜ì— ë”°ë¼ GraphQLì¿¼ë¦¬ë¥¼ ë‹¤ë¥´ê²Œ ì´ìš©í•´ì£¼ëŠ”ë°, íŠœí† ë¦¬ì–¼ ìƒì—ì„œëŠ” building-block ì»´í¬ë„ŒíŠ¸ì˜ ê²½ìš°ë¡œ ì¿¼ë¦¬ë¬¸ì„ ì§„í–‰í•´ ë³¼ ì˜ˆì •ì´ë‹¤.

1. Use GraphiQL to build the query

-ì¼ë‹¨ ì´ì „ì— ì‚¬ìš©í–ˆë˜ `gatsby-config.js`íŒŒì¼ì˜ `siteMetadata`ê°ì²´ë¥¼ í™•ì¸í•´ë³´ì.

```javascript
module.exports = {
  siteMetadata: {
    siteUrl: "https://www.yourdomain.tld",
    title: "Frog with Gatsby",
  },
```

ğŸ‘‰ ì´ ë°ì´í„°ëŠ” íŒŒíŠ¸1ì—ì„œ `new`ë¼ëŠ” ì»¤ë©˜ë“œë¥¼ í™œìš©í•´ì„œ ê°¯ì¸ ë¹„ íŒŒì¼ì„ ì²˜ìŒ ì„¤ì •í•´ì£¼ì—ˆì„ë•Œ ë§Œë“¤ì–´ì§„ ê²ƒìœ¼ë¡œ, GraphQLì˜ ë°ì´í„° ë ˆì´ì–´ì— ìë™ì ìœ¼ë¡œ ì¶”ê°€ë˜ì–´ ì‚¬ìš©ìê°€ ì¶”ê°€ì ìœ¼ë¡œ pluginì„ ì„¤ì¹˜í•´ì¤„ í•„ìš”ê°€ ì—†ë‹¤.

-`localhost:8000/___graphiql`ì— ë“¤ì–´ê°€ `GrahpiQL`ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¸í•´ë³´ì

![ GraphiQL_ex](/explorer.png)

-ìœ„ì™€ê°™ì€ ì°½ì„ ë³¼ ìˆ˜ìˆëŠ”ë° ì—¬ê¸°ì„œ `site`í•„ë“œë¥¼ ì—´ì–´ì£¼ì.  
-ë‹¤ìŒì— í‘¸ë¥¸ìƒ‰ì˜ `siteMetadata`ë¥¼ ë„£ì–´ì£¼ë©´, `gatsby-config.js`íŒŒì¼ì˜ `siteMetadata`ì™€ ëŒ€ì‘í•˜ê²Œëœë‹¤

ğŸ¤” í™œìš©í•˜ëŠ”ê±´ ê·¸ëŸ­ì €ëŸ­ ì´í•´ê°€ë˜ì—ˆëŠ”ë° ë‹¤ë¥¸ ê²½ìš°ë¥¼ ì•„ì§ ë§Œë‚˜ì§€ ëª»í•´ì„œ ì´ê²ƒì €ê²ƒ í•´ë´ì•¼ì§€ ì´í•´ê°€ í™•ì‹¤í• ê²ƒê°™ìŒ..

```jsx
query MyQuery {
  site {
    siteMetadata {
      title
    }
  }
}
```

ì¿¼ë¦¬ë¥¼ ì§„í–‰í•˜ëŠ” ê²½ìš° ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ìˆë‹¤.

```json
{
  "data": {
    "site": {
      "siteMetadata": {
        "title": "My First Gatsby Site"
      }
    }
  },
  "extensions": {}
}
```

âœ” ì´ë•Œ íŒŒì¼ì„ ìˆ˜ì •í•˜ëŠ” ê²½ìš° ë‹¤ì‹œ ê°¯ì¸ ë¹„ë¥¼ ì‹¤í–‰í•´ ìƒˆë¡œìš´ `GrahpiQL`í˜ì´ì§€ë¥¼ ì—´ì–´ì£¼ì–´ì•¼í•œë‹¤.

2.  Use useStaticQuery to pull the site title into the Layout component

building-block ì»´í¬ë„ŒíŠ¸ì— ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ì–´ì•¼í•˜ëŠ” ê²½ìš° `useStaticQuery`ë¥¼ í™œìš©í•´ ì£¼ì–´ì•¼í•œë‹¤.

ê°€. `useStaticQuery`ì™€ `graphql`ë¥¼ importí•´ì¤€ë‹¤

```jsx

import * as React from 'react'
import { Link, useStaticQuery, graphql } from 'gatsby'
import {
  container,
  heading,
  navLinks,
  navLinkItem,
  navLinkText
} from './layout.module.css'
const Layout = ({ pageTitle, children }) => {
  return (
    // ...
  )
}
export default Layout

```

ë‚˜.GraphiQLì—ì„œ ë°›ì•„ì˜¨ ì¿¼ë¦¬ë¥¼ `useStaticQuery`ë¡œ ë°›ì•„ì¤€ë‹¤. ì´ë•Œ `graphql`ë¥¼ ì´ìš©í•´ GraphQL ì¿¼ë¦¬ë¥¼ ì´ìš©í•´ì¤€ë‹¤ëŠ” ê²ƒì„ ëª…ì‹œí•´ì£¼ê³  ë³€ìˆ˜ì— ì €ì¥í•´ì¤€ë‹¤.

```jsx
const data = useStaticQuery(graphql`
  query {
    site {
      siteMetadata {
        title
      }
    }
  }
`);
```

âœ” ì´ë•Œ GraphiQLì—ì„œ ì–»ì€ ì¿¼ë¦¬ë¬¸ì—ëŠ” `MyQuery`ê°€ ìˆëŠ”ë°, ì‚¬ìš©í• ë•Œ ì´ë¥¼ ì‚­ì œí•´ì£¼ëŠ” ì´ìœ ëŠ” ì´ë¦„ì´ ì¶©ëŒì´ ë‚˜ë©´ ì•ˆë˜ì–´ì„œ !ë¼ëŠ”ë° ë§ëŠ”ì§€ ëª¨ë¥´ê²ŸìŒ ëˆ„ê°€ ì œë°œ ì•Œë ¤ì¤˜ë°” ,,

ë‹¤. ì´ë ‡ê²Œ ê°ì²´ì— ê°’ì„ ì–»ê²Œë˜ë©´, ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸ì— ë„£ì–´ ì‚¬ìš©í•  ìˆ˜ìˆë‹¤.`data.site.siteMetadata.title` ì™€ê°™ì´ ì‘ì„±í•´ ì´ìš©í•´ ì¤„ ìˆ˜ìˆë‹¤.

```jsx
const Layout = ({ pageTitle, children }) => {
  const data = useStaticQuery(graphql`
    query {
      site {
        siteMetadata {
          title
        }
      }
    }
  `)
  return (
    <div className={container}>
      <title>{pageTitle} | {data.site.siteMetadata.title}</title>
      <header>{data.site.siteMetadata.title}</header>
      ...
```

<h3>Queries in page components: Create a blog page with a list of post filenames</h3>

ë¸”ë¡œê·¸í˜ì´ì§€ë¥¼ ë§Œë“¤ì–´ë³´ë©´ì„œ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ë¥¼ í™œìš©í•´ë³´ì!

1. ë¸”ë¡œê·¸ íŒŒì¼ì„ `src/pages/blog.js`ì— ë§Œë“¤ì–´ì£¼ì!

```jsx
import * as React from "react";
import Layout from "../components/layout";
const BlogPage = () => {
  return (
    <Layout pageTitle="My Blog Posts">
      <p>My cool posts will go in here</p>
    </Layout>
  );
};
export default BlogPage;
```

âœ” ì´ì „ì— ë§Œë“¤ì–´ ì£¼ì—ˆë˜ íŒŒì¼ë“¤ê³¼ ìœ ì‚¬í•˜ê²Œ layoutê³¼ í•„ìš”í•œ ì¹œêµ¬ë“¤ì„ ë°›ì•„ì£¼ê³  ë ˆì´ì•„ì›ƒì— BLOG ë§í¬ë¥¼ ì¶”ê°€í•´ì£¼ì!

2. mdx ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…ì„ ë§Œë“¤ì–´ì£¼ì!

![ GraphiQL_ex](https://www.gatsbyjs.com/static/54dd7a9f2f7d387ff78ebbc5e1f2f566/89a37/blog-posts-folder-structure.png)

ê°€. blog í´ë” í˜•ì„±

ë‚˜.`.mdx`í™•ì¥ìë¡œ ì„¸ê°œì˜ ë¸”ë¡œê·¸ íŒŒì¼ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤

(í´ë”ëª…ì´ë‚˜,ê²Œì‹œë¬¼ì˜ ì´ë¦„ì€ ë§ˆìŒëŒ€ë¡œ í•˜ì§€ë§Œ í™•ì¥ìì˜ ì´ë¦„ì„ ì˜ì§€ì¼œì£¼ê³  í´ë”ëª…ì„ ë°”ê¿€ê²½ìš° ì œë°œ ê¸°ì–µí•´ì£¼ì^^...)

ë‹¤. ê²Œì‹œê¸€ì„ ì €ì¥í•´ì£¼ê¸°ìœ„í•´ì„œ `gatsby-source-filesystem` í”ŒëŸ¬ê·¸ì¸ì„ í™œìš©í•´ì£¼ì

```zsh
npm install gatsby-source-filesystem
```

ì´ í”ŒëŸ¬ê·¸ì¸ì˜ ê²½ìš° ì¶”ê°€ì ì¸ ì„¤ì •ì„ í•„ìš”ë¡œ í•˜ê¸° ë•Œë¬¸ì— ì„¤ì¹˜ í›„ `gatsby-config.js`ì— ì„¤ì •ì„ ì§„í–‰í•´ì£¼ì.

```javascript
 {resolve: "gatsby-source-filesystem",
      options: {
        name: `blog`,
        path: `${__dirname}/blog`,
      }
    },
```

ì´ëŸ¬í•œ ì„¤ì •ì„ í†µí•´, íŒŒì¼ë“¤ì„ ë°ì´í„° ë ˆì´ì–´ì— ë„£ì–´ì¤„ ìˆ˜ ìˆë‹¤.  
(???? ì´ê²Œ ì–´ì¼€ ë„£ì–´ì£¼ëŠ”ê±´ë°ìš” ã… ã…  )

ğŸ‘‰ ì‚¬ì´íŠ¸ê°€ êµ¬ì¶•ë˜ë©´ í”ŒëŸ¬ê·¸ì¸ì€ ê²½ë¡œ ì˜µì…˜(`${__dirname}/blog`)ì— ì €ì¥ëœ í´ë”ì˜ ëª¨ë“  íŒŒì¼ì„ ë°ì´í„° ë ˆì´ì–´ì— ì¶”ê°€í•´ì¤€ë‹¤

â• `__dirname`ëŠ” Node.jsì˜ ë³€ìˆ˜ë¡œ í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ íŒŒì¼ì´ í¬í•¨ëœ ë””ë ‰í„°ë¦¬ì˜ ì ˆëŒ€ ê²½ë¡œë¥¼ ì €ì¥í•´ì¤€ë‹¤

ë¼. ë¦¬ì•¡íŠ¸ë¥¼ ì¬ì‹œì‘í•´ì„œ ì„¤ì •í•´ì¤€ ê²ƒì„ ì €ì¥í•´ì¤€ë‹¤

ë§ˆ. `GrahpiQL`ì—ì„œ `allFile`ì„ ì´ìš©í•´ì„œ ë°ì´í„°ë¥¼ ìš”ì²­í•´ì£¼ì

ğŸ¤”`allFile`ì„ ì´ìš©í•´ì£¼ëŠ” ì´ìœ ê°€ë­ì§€??

```graphql
query MyQuery {
  allFile {
    nodes {
      name
    }
  }
}
```

ì´ë ‡ê²Œ ì§„í–‰ì„ í•´ì£¼ë©´ ì´ì „ì— ë§Œë“¤ì–´ ë†“ì•˜ë˜ ë¸”ë¡œê·¸ì˜ ì´ë¦„ì„ ì–»ê²Œëœë‹¤.

```json
{
  "data": {
    "allFile": {
      "nodes": [
        {
          "name": "my-first-post"
        },
        {
          "name": "another-post"
        },
        {
          "name": "yet-another-post"
        }
      ]
    }
  },
  "extensions": {}
}
```

ë°”. í˜ì´ì§€ ì¿¼ë¦¬ë¥¼ ì´ìš©í•´ ë°ì´í„°ë¥¼ ë³´ë‚´ì£¼ì

ì´ì „ì˜ ë¹Œë”© ì»´í¬ë„ŒíŠ¸ì™€ ìœ ì‚¬í•˜ì§€ë§Œ ì´ë²ˆì—ëŠ” `graphql`ë§Œ import í•´ì£¼ì–´ ì§„í–‰í•´ì¤€ë‹¤.

```javascript
import { graphql } from "gatsby";
```

GraphiQLì—ì„œ ë°›ì•„ì˜¨ ì¿¼ë¦¬ë¥¼ ì´ìš©í•´ì£¼ëŠ”ë° ì´ë•Œ,ì´ì „ì— ë‹¤ë¥¸ í•¨ìˆ˜ ë‚´ë¶€ì— ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ ì¿¼ë¦¬ë¥¼ ë„£ì–´ì£¼ì—ˆë˜ê²ƒê³¼ ë‹¬ë¦¬ ì™¸ë¶€ì— ë…ë¦½ì ì¸ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ exportí•´ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•´ì¤€ë‹¤

```javascript
export const query = graphql`
  query {
    allFile {
      nodes {
        name
      }
    }
  }
`;
```

ê·¸ëŸ°ë° ì´ë•Œ ì´ì „ì— GraphiQLì—ì„œ 3ê°œì˜ ë°°ì—´ì˜ í˜•íƒœë¡œ ë‚˜ì˜¤ë¯€ë¡œ mapì„ ì´ìš©í•´ì„œ ì‚¬ìš©í•´ì£¼ì

```javascript
const BlogPage = ({ data }) => {
  return (
    <Layout pageTitle="My Blog Posts">
      <ul>
        {data.allFile.nodes.map((node) => (
          <li key={node.name}>{node.name}</li>
        ))}
      </ul>
    </Layout>
  );
};
```

âœ” ë¦¬ì•¡íŠ¸ì—ì„œì˜ mapì˜ ê²½ìš°ê° ì—˜ë¦¬ë¨¼íŠ¸ë§ˆë‹¤ íŠ¹ì •í•œ keyë¥¼ ì£¼ì–´ì•¼í•œë‹¤
(?keyë¥¼ ì™œì“°ëŠ”ê±´ì§€ ì ˆëŒ€ ê³µë¶€í•´ì•¼í• ê²ƒê°™ì•„...)
ë˜í•œ ë¦¬í„´ì‹œì— ê° ë…¸ë“œë¥¼ ë£¨í”„í•´ì£¼ê³  `<li>`ë¡œ ê°ì‹¸ì£¼ì–´ì•¼í•œë‹¤
